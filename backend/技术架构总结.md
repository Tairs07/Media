# 技术架构设计总结

## 1. API 接口规范

### RESTful API 设计
- 基础路径: `/api`
- 使用标准 HTTP 方法: GET, POST, PUT, DELETE
- 统一响应格式: `ApiResponse<T>`
- 详细文档: 见 `API设计文档.md`

### 主要接口模块
1. **认证模块** (`/api/auth`)
   - 注册、登录、获取用户信息、刷新Token

2. **媒体文件模块** (`/api/media`)
   - 上传、列表、详情、删除、更新

3. **用户模块** (`/api/users`)
   - 用户信息、更新资料、用户上传列表

4. **文件访问模块** (`/api/files`)
   - 文件流、缩略图

## 2. 文件存储方案

### 实现方式
- **开发环境**: 本地文件系统存储
- **生产环境**: 支持云存储扩展（OSS/COS）

### 核心服务
- `IFileStorageService`: 文件存储接口
- `LocalFileStorageService`: 本地存储实现

### 功能特性
- 文件类型和大小验证
- 自动生成唯一文件名
- 按日期组织目录结构
- 图片缩略图自动生成（使用 SixLabors.ImageSharp）

### 配置
在 `appsettings.json` 中的 `FileStorage` 节点配置

## 3. 身份认证方案

### JWT Token 认证
- **标准**: JWT (JSON Web Token)
- **配置**: 在 `appsettings.json` 中的 `Jwt` 节点

### 实现细节
- Token 生成和验证
- 过期时间管理（默认60分钟）
- 用户会话管理（UserSessions 表）

### 安全措施
- 密码使用 BCrypt 哈希存储
- Token 存储在数据库，支持撤销
- IP 地址和 User Agent 记录

## 4. 前端路由规划

### 路由结构
- **公开路由**: 首页、登录、注册、媒体详情
- **需要认证**: 上传、个人中心、我的上传、编辑资料

### 路由守卫
- 自动检查 Token
- 未登录自动跳转登录页
- Token 过期自动清理

详细文档: 见 `frontend/路由规划.md`

## 5. 数据库设计

### 核心表
1. **Users**: 用户表
2. **MediaFiles**: 媒体文件表
3. **UserSessions**: 用户会话表

### 特性
- 完整的索引优化
- 外键约束和级联删除
- 默认值设置
- 时间戳自动管理

详细文档: 见 `backend/DatabaseDesign.md`

## 6. 项目结构

```
backend/
├── Controllers/          # API 控制器
├── Models/
│   ├── DTOs/            # 数据传输对象
│   └── [实体模型]        # 数据库实体
├── Services/            # 业务服务
├── Data/               # 数据访问（DbContext）
├── Migrations/         # 数据库迁移
└── wwwroot/uploads/    # 文件上传目录

frontend/
├── src/
│   ├── views/          # 页面组件
│   ├── router/         # 路由配置
│   ├── stores/         # 状态管理（Pinia）
│   ├── utils/          # 工具函数
│   └── bits-content/   # 动画组件库
```

## 7. 技术栈

### 后端
- .NET 9.0 Web API
- Entity Framework Core (SQLite)
- JWT Bearer Authentication
- BCrypt.Net (密码加密)
- SixLabors.ImageSharp (图片处理)
- Swagger (API 文档)

### 前端
- Vue 3
- Vite
- Vue Router
- Pinia
- Element Plus
- Axios
- GSAP & OGL (动画库)

## 8. 开发规范

### 代码规范
- C#: 遵循 Microsoft 编码规范
- TypeScript: 使用严格模式
- 命名规范: PascalCase (类/方法), camelCase (变量)

### API 规范
- 统一使用 `ApiResponse<T>` 包装响应
- 错误使用 `ErrorInfo` 结构
- 支持分页查询

### 文件命名
- 格式: `{UserId}_{Timestamp}_{Random}.{Extension}`
- 目录: 按日期组织 (`/year/month/day/`)

## 9. 下一步开发任务

1. **用户认证模块**
   - 实现注册/登录 API
   - JWT Token 生成和验证
   - 密码加密和验证

2. **文件上传模块**
   - 多文件上传
   - 文件类型验证
   - 缩略图生成
   - 元数据提取

3. **内容浏览模块**
   - 分页查询
   - 筛选和排序
   - 文件详情

4. **用户管理模块**
   - 用户信息更新
   - 上传列表查询

5. **文件访问模块**
   - 文件流式传输
   - 权限控制
   - CDN 集成（生产环境）

